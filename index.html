<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Confluence → Markdown Converter</title>
  <link rel="stylesheet" href="styles.css" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css"
  />
  <script src="https://unpkg.com/turndown/dist/turndown.js"></script>
  <script src="https://unpkg.com/turndown-plugin-gfm/dist/turndown-plugin-gfm.js"></script>
  <script src="converter.js"></script>
  <script src="https://unpkg.com/prettier@2.8.8/standalone.js"></script>
  <script src="https://unpkg.com/prettier@2.8.8/parser-html.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body>
  <header>
    <div class="title">
      <span class="pill">Extension</span>
      <h1>Confluence → Markdown Converter</h1>
    </div>
    <div class="tabs">
      <button class="tab active" data-tab="convert">Convert</button>
      <button class="tab" data-tab="settings">Settings</button>
    </div>
  </header>

  <main>
    <section class="panel active" id="panel-convert">
      <div class="panel-grid">
        <div class="card card-accent">
          <div class="card-header">
            <div>
              <p class="eyebrow">Context menu ready</p>
              <h2>Paste or ingest Confluence snippets</h2>
            </div>
            <div class="actions">
              <button class="secondary" id="clearPaste">Clear</button>
              <button class="primary" id="copyMarkdown">Copy Markdown</button>
            </div>
          </div>
          <div class="status-row">
            <span id="status">Waiting for content…</span>
          </div>

          <div class="accordion">
            <details id="section-copied" class="fold">
              <summary>
                <div class="summary-content">
                  <span class="summary-title">Copied content</span>
                  <span class="summary-hint">Rendered preview (default collapsed)</span>
                </div>
              </summary>
              <div class="fold-body">
                <div class="fold-actions">
                  <button class="secondary" id="pasteFromClipboard">Paste from clipboard</button>
                </div>
                <small>Click and paste here, or use the right-click menu to prefill.</small>
                <div id="pasteArea" contenteditable="true" aria-label="Confluence HTML preview"></div>
              </div>
            </details>

            <details id="section-html" class="fold">
              <summary>
                <div class="summary-content">
                  <span class="summary-title">Raw HTML</span>
                  <span class="summary-hint">Debug view</span>
                </div>
              </summary>
              <div class="fold-body">
                <div class="code-panel">
                  <div class="code-panel__header">
                    <span class="muted">Formatted &amp; highlighted</span>
                  </div>
                  <pre class="code-panel__body"><code id="htmlHighlight" class="language-html"></code></pre>
                </div>
                <textarea id="htmlView" spellcheck="false" aria-label="Raw HTML (formatted)"></textarea>
              </div>
            </details>

            <details id="section-markdown" class="fold" open>
              <summary>
                <div class="summary-content">
                  <span class="summary-title">Markdown output</span>
                  <span class="summary-hint">Default open</span>
                </div>
              </summary>
              <div class="fold-body">
                <textarea id="markdownView" spellcheck="false"></textarea>
                <div class="controls">
                  <div class="option-group">
                    <label>
                      <input type="checkbox" id="includeLinks" checked />
                      Include links
                    </label>
                    <label>
                      <input type="checkbox" id="includeImagePlaceholders" checked />
                      Image placeholders
                    </label>
                    <label>
                      <input type="checkbox" id="emojiNames" />
                      Emoji names
                    </label>
                  </div>
                </div>
              </div>
            </details>
          </div>
        </div>

        <div class="card notes-card">
          <p class="eyebrow">Notes</p>
          <p class="muted">If something looks wrong, describe it to ChatGPT and update <code>rules.json</code>. Reload, then paste again.</p>
        </div>
      </div>
    </section>

    <section class="panel" id="panel-settings">
      <div class="panel-grid">
        <div class="card">
          <p class="eyebrow">Rules JSON (read-only)</p>
          <p class="muted">Rules are stored in <code>rules.json</code>. Edit that file and reload this page to apply changes.</p>
          <div class="controls">
            <span id="rulesStatus"></span>
          </div>
          <textarea id="rulesArea" spellcheck="false" readonly></textarea>
        </div>
      </div>
    </section>
  </main>

  <script src="app.js"></script>
</body>
</html>
